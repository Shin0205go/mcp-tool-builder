<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>Item Details</title>
  
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f5f5; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
    .header h1 { color: #333; }
    .btn-primary { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
    .btn-secondary { background: #6c757d; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
    .btn-danger { background: #dc3545; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
    .back-btn { background: none; border: 1px solid #ccc; padding: 8px 15px; border-radius: 4px; cursor: pointer; }
    .form-group { margin-bottom: 20px; }
    .form-label { display: block; margin-bottom: 5px; font-weight: 500; color: #333; }
    .form-input, .form-textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
    .form-actions { margin-top: 30px; display: flex; gap: 10px; }
    .status-message { margin-top: 20px; padding: 15px; border-radius: 4px; }
    .status-message.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .status-message.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .table-container { background: white; border-radius: 8px; overflow: hidden; }
    .data-table { width: 100%; border-collapse: collapse; }
    .data-table th, .data-table td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
    .data-table th { background: #f8f9fa; font-weight: 500; }
    .filters { margin-bottom: 20px; background: white; padding: 20px; border-radius: 8px; }
    .filter-row { display: flex; gap: 10px; align-items: center; }
    .pagination { display: flex; justify-content: center; margin-top: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Item Details</h1>
      <div class="header-actions">
        <button class="btn-primary" onclick="editEntity()">Edit</button>
        <button class="back-btn" onclick="history.back()">‚Üê Back</button>
      </div>
    </div>
    
    <div class="detail-view" id="detailContent">
      <!-- Content will be loaded here -->
    </div>
    
    <div id="status" class="status-message"></div>
  </div>
  
  
  <script>
    const ALLOWED_ORIGIN = 'http://localhost:3000';
    
    document.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      const entityId = urlParams.get('id');
      if (entityId) {
        loadEntityDetails(entityId);
      }
    });
    
    function loadEntityDetails(id) {
      const requestId = crypto.randomUUID();
      
      window.parent.postMessage({
        type: 'mcp:tool.invoke',
        requestId: requestId,
        tool: 'getItemById',
        params: { id: id }
      }, ALLOWED_ORIGIN);
      
      const messageHandler = (event) => {
        if (event.origin !== ALLOWED_ORIGIN) return;
        const { type, requestId: responseId, result, error } = event.data || {};
        
        if (responseId !== requestId) return;
        
        if (type === 'mcp:tool.result') {
          renderDetails(result);
        } else if (type === 'mcp:tool.error') {
          showStatus('Error: ' + (error || 'Failed to load details'), 'error');
        }
        
        window.removeEventListener('message', messageHandler);
      };
      
      window.addEventListener('message', messageHandler);
    }
    
    function renderDetails(entity) {
      const container = document.getElementById('detailContent');
      container.innerHTML = `
        <div class="detail-grid">
          <div class="detail-item">
            <label>Id:</label>
            <span>${entity.id || '-'}</span>
          </div>
          <div class="detail-item">
            <label>Created At:</label>
            <span>${entity.createdAt || '-'}</span>
          </div>
          <div class="detail-item">
            <label>Updated At:</label>
            <span>${entity.updatedAt || '-'}</span>
          </div>
          <div class="detail-item">
            <label>Name:</label>
            <span>${entity.name || '-'}</span>
          </div>
          <div class="detail-item">
            <label>Description:</label>
            <span>${entity.description || '-'}</span>
          </div>
        </div>
      `;
    }
  </script>
</body>
</html>